# 数据库迁移设置说明

## Flyway 迁移脚本规范

### 脚本命名规则
- `V{版本号}__{描述}.sql` - 版本化迁移脚本（只执行一次）
- `R__{描述}.sql` - 可重复执行脚本（每次启动都会检查并执行）

### 当前迁移脚本
- `V0__Create_database.sql` - 数据库初始化（开发环境用）
- `V1__Create_user_table.sql` - 创建用户表及基础数据

### 执行顺序
1. V0 - 创建数据库（开发环境）
2. V1 - 创建用户表和测试数据

### 注意事项
1. 生产环境建议手动创建数据库，不要依赖 V0 脚本
2. 所有迁移脚本必须是幂等的（可重复执行）
3. 不要修改已经执行过的脚本，如需变更请创建新的版本脚本
4. 测试数据应该放在单独的脚本中，便于生产环境排除

### 环境配置
- 开发环境：执行所有脚本包括测试数据
- 生产环境：只执行结构脚本，排除测试数据

## 使用方法

### 开发环境初始化
```bash
# 1. 确保 MySQL 服务运行
# 2. 启动应用，Flyway 会自动执行迁移脚本
mvn spring-boot:run
```

### 手动执行迁移
```bash
# 使用 Maven 插件执行
mvn flyway:migrate

# 查看迁移状态
mvn flyway:info

# 清理数据库（仅开发环境）
mvn flyway:clean
```

### 生产环境部署
1. 手动创建数据库：`daily_discover`
2. 配置数据库连接信息
3. 启动应用，Flyway 自动执行迁移